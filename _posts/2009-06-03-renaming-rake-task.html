---
layout: post
title: Renaming a Rake task
date: '2009-06-03T00:16:00.000-07:00'
author: Ladislav Slez√°k
tags:
- ruby
- rake
- rename task
- ruby on rails
modified_time: '2010-09-16T06:59:50.842-07:00'
blogger_id: tag:blogger.com,1999:blog-6535501136403374362.post-2099780455769054613
blogger_orig_url: http://lslezak.blogspot.com/2009/06/renaming-rake-task.html
---

Rake has a class for creating packaging task which builds a compressed package from the sources. It's called <span style="font-weight: bold;">Rake::PackageTask</span> and it's quite easy to use it, <a href="http://rake.rubyforge.org/classes/Rake/PackageTask.html">see the documentation</a>.<br /><br />Unfortunately the name of the created task is <span style="font-weight: bold;">package</span> and it's hardcoded so it cannot be changed.<br />Yast uses make and the standard targets are <span style="font-weight: bold;">package</span> and <span style="font-weight: bold;">package-local</span><span style="font-weight: bold;">.</span><br /><br /><ul><li><span style="font-weight: bold;">package-local</span> - build a tarball source package<br /></li><li><span style="font-weight: bold;">package</span> - does some checks (like SVN repository update check, syntax check, runs the testsuite...) to ensure that the built package follows some rules so it will less likely break something.<br /></li></ul><br />We wanted to use the same targets in the Web Yast which uses Ruby on Rails and Rake as the make replacement.<br /><br />The problem is how to change the package task name. In Ruby it's possible to change or extend even the core classes like <span style="font-style: italic;">String</span> or <span style="font-style: italic;">Object</span>, which might be good or bad because you can break all Ruby applications very easily... But this feature allow us to extend Rake as we need.<br /><br />The following code adds <span style="font-weight: bold;">rename</span> method to <span style="font-weight: bold;">Rake::Task</span> class:<br /><pre class="ruby"><br /><span class="comment"># add rename_task method to Rake::Application</span><br /><span class="comment"># it has an internal hash with name -&gt; Rake::Task mapping</span><br /><span class="keyword">module </span><span class="module">Rake</span><br /><span class="keyword">class </span><span class="class">Application</span><br /> <span class="keyword">def </span><span class="method">rename_task</span><span class="punct">(</span><span class="ident">task</span><span class="punct">,</span> <span class="ident">oldname</span><span class="punct">,</span> <span class="ident">newname</span><span class="punct">)</span><br />     <span class="keyword">if</span> <span class="attribute">@tasks</span><span class="punct">.</span><span class="ident">nil?</span><br />     <span class="attribute">@tasks</span> <span class="punct">=</span> <span class="punct">{}</span><br />     <span class="keyword">end</span><br /><br />     <span class="attribute">@tasks</span><span class="punct">[</span><span class="ident">newname</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">]</span> <span class="punct">=</span> <span class="ident">task</span><br /><br />     <span class="keyword">if</span> <span class="attribute">@tasks</span><span class="punct">.</span><span class="ident">has_key?</span> <span class="ident">oldname</span><br />     <span class="attribute">@tasks</span><span class="punct">.</span><span class="ident">delete</span> <span class="ident">oldname</span><br />     <span class="keyword">end</span><br /> <span class="keyword">end</span><br /><span class="keyword">end</span><br /><span class="keyword">end</span><br /><br /><span class="comment"># add new rename method to Rake::Task class</span><br /><span class="comment"># to rename a task</span><br /><span class="keyword">class </span><span class="class">Rake::Task</span><br /><span class="keyword">def </span><span class="method">rename</span><span class="punct">(</span><span class="ident">new_name</span><span class="punct">)</span><br /> <span class="keyword">if</span> <span class="punct">!</span><span class="ident">new_name</span><span class="punct">.</span><span class="ident">nil?</span><br />     <span class="ident">old_name</span> <span class="punct">=</span> <span class="attribute">@name</span><br /><br />     <span class="keyword">if</span> <span class="ident">old_name</span> <span class="punct">==</span> <span class="ident">new_name</span><br />     <span class="keyword">return</span><br />     <span class="keyword">end</span><br /><br />     <span class="attribute">@name</span> <span class="punct">=</span> <span class="ident">new_name</span><span class="punct">.</span><span class="ident">to_s</span><br />     <span class="ident">application</span><span class="punct">.</span><span class="ident">rename_task</span><span class="punct">(</span><span class="constant">self</span><span class="punct">,</span> <span class="ident">old_name</span><span class="punct">,</span> <span class="ident">new_name</span><span class="punct">)</span><br /> <span class="keyword">end</span><br /><span class="keyword">end</span><br /><span class="keyword">end</span><br /></pre><br />And an example how to use it:<br /><pre class="ruby"><br /><span class="comment"># rename 'package' task to 'package-local' task</span><br /><span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:package</span><span class="punct">].</span><span class="ident">rename</span><span class="punct">(</span><span class="symbol">:"</span><span class="symbol">package-local</span><span class="symbol">"</span><span class="punct">)</span><br /></pre><br />It was quite difficult to figure out the rake internals, so I hope it will help somebody else...