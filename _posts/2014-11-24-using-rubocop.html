---
layout: post
title: Using Rubocop
date: '2014-11-24T07:16:00.002-08:00'
author: Ladislav Slez√°k
tags: 
modified_time: '2014-11-24T07:16:29.837-08:00'
blogger_id: tag:blogger.com,1999:blog-6535501136403374362.post-3811464988532694531
blogger_orig_url: http://lslezak.blogspot.com/2014/11/using-rubocop.html
---

<h2>Introduction</h2><div><br /></div><a href="https://github.com/bbatsov/rubocop" target="_blank">Rubocop</a>&nbsp;is a Ruby static code analyzer which looks for common code smells and checks the coding style.<br /><h2>Installation</h2>The installation is quite easy, just run "<span style="font-family: Courier New, Courier, monospace;">sudo gem install rubocop</span>" command (assuming you have Ruby alredy installed).<br /><h2>Initial Run and Creating the Config File</h2>If there is no <span style="font-family: Courier New, Courier, monospace;">.rubocop.yml</span> file in your project root then Rubocop uses <a href="https://github.com/bbatsov/rubocop/blob/master/config/default.yml" target="_blank">the default configuration</a>.<br /><br />It is a good idea to let Rubocop generate the project default for you, simply run "<span style="font-family: Courier New, Courier, monospace;">rubocop&nbsp;--auto-gen-config</span>". This will create <span style="font-family: Courier New, Courier, monospace;">.rubocop_todo.yml</span> file which can be used as a template for your initial config file.<br /><br />The default generated config file disables all checks which fail. That means if you run Rubocop with this config file (or if you remove the <span style="font-family: Courier New, Courier, monospace;">_todo</span> suffix) it will report success.<br /><h2>Fixing the Issues</h2><div>Now you can go one by one disabled check in the created template, enable each check and see where the problem is and whether it's a valid issue according to your style or preferences.</div><div><br /></div>There are basically these solutions how to fix an error reported by Rubocop:<br /><br /><ul><li>Fix the issue according to the suggestions reported by Rubocop</li><li>Let Rubocop to fix it for you (does not work for all issues found, but majority of coding style issues, like indentation or white space usage, can be fixed automatically), just add "<span style="font-family: Courier New, Courier, monospace;">-a</span>" or "<span style="font-family: Courier New, Courier, monospace;">--auto-correct</span>" option. You should manually check the changes done ("<span style="font-family: Courier New, Courier, monospace;">git diff</span>") after auto correction, just to be sure the fix was correct and had no side effects.</li><li>Change the expected style (e.g. the default Rubocop style is single quoted string literals, if you prefer double quoted strings in your project then set the different default in the config), see the possible options in&nbsp;<a href="https://github.com/bbatsov/rubocop/blob/master/config/default.yml" target="_blank">the default configuration</a>.</li><li><a href="https://github.com/bbatsov/rubocop#disabling-cops-within-source-code" target="_blank">Disable the check locally</a> in the code (e.g. the rule is valid, but the specific place in the code is an exception where breaking the rule is correct, for example you prefer "<span style="font-family: Courier New, Courier, monospace;">.nil?"</span> over "<span style="font-family: Courier New, Courier, monospace;">== nil</span>", but in a test you want to check your <span style="font-family: Courier New, Courier, monospace;">operator= </span>definition correctly handles <span style="font-family: Courier New, Courier, monospace;">nil</span> comparison)</li><li>Disable the check globally</li></ul><br /><h2>Using Rubocop in CI</h2>To ensure that the coding style is honored during development it is a good idea to run Rubocop at CI (Continuous Integration) server like Travis or Jenkins.<br /><h2>Rubocop in Yast</h2>I tried to start with Rubocop in the Yast <a href="https://github.com/yast/yast-registration" target="_blank">registration module</a> which is written from scratch and should not contain ugly code parts introduced by YCP to Ruby conversion.<br /><br />Initially it reported almost 3000 (!) offenses, but many of them were false positives caused by different coding style defaults (e.g. single quote vs. double quote string literals). After adapting the config style (and relaxing some metric checks which would require non-trivial refactoring) the number of issues was decreased to just about 900.<br /><br />Majority issues were harmless and related to white space, but some of the checks found really bad code, like this&nbsp;<a href="https://github.com/yast/yast-registration/commit/4f4819838723e7ddd7598976db29268226838557" target="_blank">"private" modifier issue</a>.<br /><br />Thanks to the nice auto correction feature the majority of the issues&nbsp;(~830 which is about 92%)&nbsp;could be fixed automatically. So the number of the manual changes was rather small.<br /><br />I found only two issues with auto correction - at one place it removed a comment which was inside a removed block (moved outside the block) and in another case it added a trailing space at the end of the line (at that time I had the trailing check disabled so it was not fixed by another check).<br /><br />You can see all the changes in <a href="https://github.com/yast/yast-registration/pull/177" target="_blank">this pull request</a>.<br /><h2>Result</h2>It was a nice experience with Rubocop as it not only complains what is wrong but also suggests the solution how to fix the found issues. More over it has auto correct feature which works very well and can fix almost all coding styles issues automatically.<br /><br />So let see if we can use it in more Yast modules...<br /><br />