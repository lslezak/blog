---
layout: post
title: Adding a new package to the inst-sys (openSUSE installation system) or to the
  rescue system
date: '2013-10-25T02:20:00.002-07:00'
author: Ladislav Slez√°k
tags: 
modified_time: '2013-10-25T02:22:57.082-07:00'
blogger_id: tag:blogger.com,1999:blog-6535501136403374362.post-8347328433517129730
blogger_orig_url: http://lslezak.blogspot.com/2013/10/adding-new-package-to-opensuse.html
---

<h3>Why?</h3><br />Sometimes you need to add a new RPM to the openSUSE installation system (called <i>inst-sys</i>) or to the rescue image. Especially in Yast development we usually need to include new tools or some new subsystems (like the recent Yast switch to Ruby required adding Ruby interpreter into the inst-sys).<br /><br /><h3>How?</h3><br />The overall procedure is quite simple, basically you need to modify <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">installation-images</span> package and then remaster the installation medium (or update the boot server, depending how you boot the system). But there are some tricky parts...<br /><br /><h3>Installation-images</h3><br />This RPM builds file system images (using compressed <a href="http://squashfs/" target="_blank">squashfs</a> to save valuable space) with installation system and the rescue system.<br /><br />If you want to add a new package then follow these steps:<br /><ol><li>Checkout the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">installation-images</span> package for your target distribution from <a href="https://build.opensuse.org/" target="_blank">OBS</a>, e.g. <pre class="terminal">osc co openSUSE:13.1 installation-images</pre></li><li>Add your new package to the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">BuildRequires</span> list in the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">installation-images.spec</span> file</li><li>Modify the package list for the target file system image, which is stored<span style="font-family: inherit;"> in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">*.file_list</span> file. You can find a full example <a href="https://build.opensuse.org/package/rdiff/openSUSE:13.1/installation-images?linkrev=base&amp;rev=2" target="_blank">here</a>, there is a diff for adding <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">libyui-qt-graph</span> package to the inst-sys. You can include a complete package or only explicitly listed files (this is usefull if the package is huge and you need just a small file from it).<br /><i>Note: If you want to </i></span><i>later update the installation-images package used as the base then it is better to use a patch instead of directly modifying the file list. It can be later easily applied to an updated version.</i></li><li>Build the package locally using&nbsp; <pre class="terminal">osc build --userootforbuild</pre><span style="font-family: inherit;">command.<br />This will take some time, it needs a lot of packages and building the target file system images is also not trivial. <br />The build requires <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">root</span> user, without the extra option it would fail. If you really need to build the package in the OBS server automatically then you need to ask the OBS maintainers for adding an exception for your package.<br />(In <a href="https://build.opensuse.org/package/show/YaST:Head:installer/installation-images" target="_blank">YaST:Head:installer/installation-images</a> we have such an exception.)</span></li></ol><br /><h3>Updating the medium</h3><h3></h3><br />Updating the boot medium is quite tricky, you need to unpack the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/CD1</span> and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/SuSE/openSUSE/CD1</span> directories from the built installation-images RPM package and overwrite the original files and create the ISO image again.<br /><br />But I have actually never tried that, in OBS we simply build our own ISO image using <a href="https://build.opensuse.org/package/show/YaST:Head:installer/minidvd-x86_64" target="_blank">a kiwi project</a>.